name: Build Plugin

on:
  pull_request:
    branches: [develop, master]

jobs:

  build:
    env:
      REPO_NAME: unbox-schema-plugin

    runs-on: [ubuntu-18.04]

    steps:
    - name: Checking out this repo
      uses: actions/checkout@v2
      with:
        path: plugin

    - name: Checking out unbox-plus/reaction core repo
      uses: actions/checkout@v2
      with:
        repository: unbox-plus/reaction
        path: core
        ref: develop
        token: ${{ secrets.CORE_ACCESS_TOKEN }}

    - name: Copying plugin code to core
      run: |
        mkdir ./core/imports/plugins/custom/$REPO_NAME
        cp -r ./plugin/* ./core/imports/plugins/custom/$REPO_NAME

    - name: Building the Docker image
      working-directory: ./core
      run: docker build . --file Dockerfile --tag my-image-name:$(date +%s)
